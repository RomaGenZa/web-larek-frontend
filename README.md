# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 

### Слой данных  


#### Класс Cart  
Отвечает за управление корзиной покупок, включая добавление и удаление продуктов, а также уведомление об этих действиях.  

- Конструктор данного класса создает корзину с начальным списком продуктов (по умолчанию пустым), а так же подписывает корзину на события, чтобы автоматически добавлять или удалять товары при соответствующих событиях. 


- `eventBroker` объект типа `EventEmitter`, который используется для управления событиями внутри приложения. Через него прослушиваются события, такие как добавление или удаление товаров из корзины, и также генерируются события о том, что продукт был добавлен или удалён.


- `products` массив товаров типа `IProduct`, представляющий список продуктов в корзине. По умолчанию корзина пустая, инициализируется как пустой массив. Если при создании объекта передать список продуктов, корзина будет инициализирована с ними.


- Методы:  

  - `itemsCount()` возвращает количество товаров в корзине, используя длину массива `products`.  

  - `addProduct(product: IProduct)` добавляет продукт в корзину.

  - `removeProduct(product: IProduct)` удаляет продукт из корзины.  


#### Класс DefaultRestClient  
Реализует API-клиент для взаимодействия с REST-сервером. Он выполняет запросы к API для получения списка продуктов, отдельного продукта, а также создания заказа.  

- Конструктор данного класса отвечает за инициализацию API-клиента, который взаимодействует с сервером для выполнения запросов на получение продуктов и создание заказа. Он также настраивает обработку событий через объект `EventEmitter`.

- `eventBroker` объект типа `EventEmitter`, который используется для генерации событий внутри приложения. Через этот объект передаются события, такие как успешная загрузка продуктов или создание заказа. Это позволяет другим компонентам приложения реагировать на изменения данных.

- `api` экземпляр класса Api, который используется для выполнения HTTP-запросов  (GET, POST и т.д.) к REST API сервера.  


- Методы:  

  - `getProductList()` асинхронный метод для получения списка продуктов. Выполняет GET-запрос на `/product` с помощью `api`. Если запрос успешен, результат сохраняется в переменную `listItems`. Генерирует событие `DidLoadProducts`, передавая полученные продукты другим слушателям.
  - `getProductItem(id: string)` асинхронный метод для создания заказа. Принимает объект order типа `IOrder`, содержащий данные заказа. Выполняет POST-запрос на `/order` с данными заказа и генерит событие `DidCreateOrder`, передавая результат транзакции.  

  
### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.  


#### Класс MainView  
Реализует интерфейс `IView` для отображения основного списка продуктов и обработки событий, связанных с отображением карточек продуктов и открытия модальных окон с подробной информацией о продукте.  


- Конструктор класса `MainView` отвечает за настройку списка продуктов, а также за подписку на события, связанные с рендерингом продуктов и отображением модального окна с информацией о выбранном продукте.  

  - `container` основной контейнер на странице, в котором будет рендериться список продуктов. Это DOM-элемент, куда вставляются карточки продуктов, созданные для каждого элемента списка.  

  - `eventBroker` объект, который управляет событиями. Он используется для подписки на события и их обработки, такие как загрузка списка продуктов и выбор конкретного продукта для отображения в модальном окне.  


- Методы:  

  - `render(products: IProduct[])` рендерит карточки продуктов на странице отображая массив объектов продуктов, который нужно показать в виде карточек.

  - `showProduct(product: IProduct)` отображает модальное окно с информацией о выбранном продукте


#### Класс ModalProductView 
Реализует интерфейс `IView` и отвечает за отображение модального окна с информацией о продукте в интерфейсе.  
Это представление, которое рендерит продукт в модальном окне, добавляет его в корзину по клику и применяет соответствующие стили на основе категории продукта.
- `container` элемент `HTMLDivElement`, в котором происходит рендеринг модального окна.
- `eventBroker` объект типа EventEmitter, который используется для публикации событий, таких как добавление товара в корзину.  


    Так же класс предоставляет набор методов  


- Метод `render(product: IProduct)` отвечает за отображение информации о продукте в модальном окне.
  - `this.container.querySelector` ищет соответствующие HTML-элементы (например, категория, заголовок, изображение) в DOM контейнере.
  - `setCategoryClass()` — устанавливает CSS-класс категории товара с помощью функции `productCategoryToClass`, чтобы отобразить правильный стиль.
  - `title.textContent = product.title` — устанавливает название товара.
  - `image.src` и `image.alt` — задают ссылку на изображение товара и текст для атрибута alt.
  - `cardDescription.textContent = product.description` — задает описание товара.
  - `addToCartButton.addEventListener("click", ...)` — добавляет обработчик события для кнопки "добавить в корзину".
  - `price.textContent` — выводит цену товара или сообщение "Бесценно", если цена отсутствует.

- Метод `addToCart(product: IProduct)` Вызывает событие `CartEvents.AddProductToCart`, чтобы добавить продукт в корзину.

- Метод `setCategoryClass(cardCategory: HTMLSpanElement, category: ProductCategory)` сначала удаляет все возможные классы категории, затем добавляет нужный CSS-класс, сгенерированный функцией `productCategoryToClass` и устанавливает текст категории.  

#### Класс ProductCardView
Представляет собой компонент для отображения карточки продукта. Он реализует интерфейс `IView` и используется для рендеринга информации о продукте в виде карточки, а также для обработки пользовательского клика на эту карточку.  

- Конструктор инициализирует объект для отображения карточки продукта и связывает его с системой событий, чтобы реагировать на действия пользователя, такие как клик на карточку.  

  - `container` HTML-контейнер, который представляет собой кнопку-карточку продукта. В этом элементе будут отображаться данные продукта

  - `eventBroker` объект для управления событиями в приложении. EventEmitter отвечает за публикацию и подписку на события.  


- Методы:

  - `render` Этот метод отвечает за рендеринг карточки продукта на основе данных, переданных в объекте product. Он обновляет HTML-элементы внутри карточки и добавляет обработчик событий на клик.

  - `setCategoryClass` отвечает за установку CSS-классов, соответствующих категории продукта.

### Слой коммуникации